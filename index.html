<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>üéÑ Team Holiday Trivia (Host Controlled)</title>
    <style>
      :root {
        --bg: #071326;
        --bg2: #0b2a2a;
        --card: #0f1f33cc;
        --text: #eaf2ff;
        --muted: #b8c7e6;
        --gold: #ffd46a;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        min-height: 100vh;
        color: var(--text);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
        background: radial-gradient(
            900px 600px at 15% 10%,
            #1b5a8c55,
            transparent 60%
          ),
          radial-gradient(800px 600px at 80% 20%, #1aa37a35, transparent 55%),
          linear-gradient(135deg, var(--bg), var(--bg2));
      }
      .wrap {
        max-width: 1050px;
        margin: 0 auto;
        padding: 18px;
      }
      header {
        position: sticky;
        top: 0;
        z-index: 5;
        backdrop-filter: blur(10px);
        background: linear-gradient(
          180deg,
          rgba(3, 10, 20, 0.88),
          rgba(3, 10, 20, 0.45)
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }
      .top {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .logo {
        width: 44px;
        height: 44px;
        border-radius: 14px;
        display: grid;
        place-items: center;
        background: linear-gradient(135deg, #d43b3b, #1aa37a);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 18px 45px rgba(0, 0, 0, 0.35);
        user-select: none;
      }
      h1 {
        font-size: 18px;
        margin: 0;
      }
      .sub {
        margin: 2px 0 0;
        color: var(--muted);
        font-size: 12px;
      }
      .pillbar {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .pill {
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(15, 31, 51, 0.55);
        display: flex;
        gap: 10px;
        align-items: center;
        font-size: 13px;
        color: var(--muted);
      }
      input {
        background: rgba(0, 0, 0, 0.18);
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.16);
        border-radius: 12px;
        padding: 8px 10px;
        outline: none;
      }
      input::placeholder {
        color: #b9c7e699;
      }
      button {
        background: linear-gradient(135deg, #1aa37a, #2b7dff);
        color: #06101b;
        border: none;
        border-radius: 14px;
        padding: 10px 12px;
        font-weight: 800;
        cursor: pointer;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.26);
      }
      button.secondary {
        background: rgba(255, 255, 255, 0.08);
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.16);
        box-shadow: none;
        font-weight: 700;
      }
      button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }
      .grid {
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 16px;
        margin-top: 16px;
      }
      @media (max-width: 920px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
      .card {
        background: var(--card);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 22px;
        box-shadow: 0 18px 45px rgba(0, 0, 0, 0.35);
        overflow: hidden;
      }
      .hd {
        padding: 14px 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }
      .bd {
        padding: 16px;
      }
      .hint {
        color: var(--muted);
        font-size: 13px;
        line-height: 1.45;
      }
      .arena {
        margin-top: 12px;
        border-radius: 18px;
        border: 1px dashed rgba(255, 255, 255, 0.2);
        background: rgba(0, 0, 0, 0.16);
        padding: 14px;
        min-height: 260px;
        position: relative;
      }
      .kpi {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .chip {
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(255, 255, 255, 0.06);
        padding: 8px 10px;
        border-radius: 999px;
        font-size: 12px;
        color: var(--muted);
      }
      .wordgrid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
        margin-top: 12px;
      }
      @media (max-width: 520px) {
        .wordgrid {
          grid-template-columns: 1fr;
        }
      }
      .wbtn {
        padding: 12px 10px;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        cursor: pointer;
        text-align: left;
        font-weight: 800;
        user-select: none;
      }
      .wbtn.good {
        background: rgba(92, 255, 179, 0.18);
        border-color: rgba(92, 255, 179, 0.3);
      }
      .wbtn.bad {
        background: rgba(255, 107, 107, 0.16);
        border-color: rgba(255, 107, 107, 0.26);
      }
      .leaderboard {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .lbrow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 12px 12px;
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.05);
      }
      .badge {
        width: 34px;
        height: 34px;
        border-radius: 14px;
        display: grid;
        place-items: center;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.14);
      }
      .score {
        font-weight: 1000;
        color: var(--gold);
      }
      .toast {
        position: absolute;
        right: 12px;
        bottom: 12px;
        background: rgba(0, 0, 0, 0.35);
        border: 1px solid rgba(255, 255, 255, 0.14);
        padding: 10px 12px;
        border-radius: 14px;
        font-size: 12px;
        color: var(--muted);
        transform: translateY(6px);
        opacity: 0;
        transition: 0.2s;
      }
      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }
    </style>

    <!-- Firebase (compat for simple copy/paste usage) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  </head>

  <body>
    <header>
      <div class="wrap">
        <div class="top">
          <div class="brand">
            <div class="logo">üéÅ</div>
            <div>
              <h1>Team Holiday Trivia</h1>
              <div class="sub">
                Host-controlled ‚Ä¢ shared leaderboard ‚Ä¢ everyone starts together
              </div>
            </div>
          </div>
          <div class="pillbar">
            <div class="pill">
              <span>Player</span>
              <input id="playerName" placeholder="e.g., Alex" maxlength="24" />
            </div>
            <button id="startBtn">Start</button>
            <button class="secondary" id="endTurnBtn">End turn</button>
            <button
              class="secondary"
              id="resetAll"
              title="Clears Firestore scores"
            >
              Reset
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="wrap">
      <div class="grid">
        <section class="card">
          <div class="hd">
            <strong>üéÑ Trivia Round</strong>
            <span class="hint"
              >Host starts/ends for everyone ‚Ä¢ scores submit on End turn</span
            >
          </div>
          <div class="bd">
            <div class="kpi">
              <div class="chip">Player: <strong id="who">‚Äî</strong></div>
              <div class="chip">
                Round score: <strong id="roundScore">0</strong>
              </div>
              <div class="chip">Status: <strong id="status">LOBBY</strong></div>
            </div>

            <div class="arena" id="arena">
              <div class="hint">
                Type your name to join. Wait for the host to press <b>Start</b>.
              </div>
              <div class="toast" id="toast"></div>
            </div>
          </div>
        </section>

        <aside class="card">
          <div class="hd">
            <strong>üèÜ Shared Leaderboard</strong>
            <button class="secondary" id="seedDemo">Demo</button>
          </div>
          <div class="bd">
            <div class="hint">
              Everyone at the same URL sees the same scores (live).
            </div>
            <div style="height: 12px"></div>
            <div id="leaderboard" class="leaderboard"></div>
          </div>
        </aside>
      </div>
    </main>

    <script>
      /* =========================
   0) Firebase config
========================= */
      const firebaseConfig = {
        apiKey: "AIzaSyCZ9bUCQOUz4hdDd3Iur3TPAAKiTzyuTbk",
        authDomain: "rimac-funny-game.firebaseapp.com",
        projectId: "rimac-funny-game",
        storageBucket: "rimac-funny-game.firebasestorage.app",
        messagingSenderId: "759424355912",
        appId: "1:759424355912:web:032f3b6335d2aeabbdd27d",
        measurementId: "G-GRE229K5WX",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const scoresRef = db.collection("scores");
      const gameStateRef = db.collection("game").doc("state");

      /* =========================
   1) Host secret code
========================= */
      const ADMIN_CODE = "EmiliaIsTheBest";
      // Host unlock via title click (secret gesture)
      document.querySelector("h1").addEventListener("dblclick", () => {
        requireHost();
      });

      let isHost = sessionStorage.getItem("isHost") === "1";

      function $(s) {
        return document.querySelector(s);
      }
      const arena = $("#arena");

      function toast(msg) {
        const t = $("#toast");
        t.textContent = msg;
        t.classList.add("show");
        clearTimeout(t._to);
        t._to = setTimeout(() => t.classList.remove("show"), 1200);
      }

      function updateHostUI() {
        $("#startBtn").disabled = !isHost;
        $("#endTurnBtn").disabled = !isHost;
        $("#resetAll").style.display = isHost ? "inline-block" : "none";

        $("#startBtn").title = isHost
          ? "Start round for everyone"
          : "Host only";
        $("#endTurnBtn").title = isHost
          ? "End round for everyone"
          : "Host only";
      }
      updateHostUI();

      function requireHost() {
        if (isHost) return true;
        const entered = prompt("Host code?");
        if (entered !== ADMIN_CODE) {
          toast("Wrong code");
          return false;
        }
        isHost = true;
        sessionStorage.setItem("isHost", "1");
        updateHostUI();
        toast("Host unlocked");
        return true;
      }

      /* =========================
   2) Trivia content (edit freely)
========================= */
      const TRIVIA = [
        {
          q: "What actually caused the last production issue?",
          a: [
            "A missing semicolon",
            "'It worked on my machine'",
            "No one remembers",
            "Someone merged on Friday",
          ],
          c: 2,
        },
        {
          q: "How long does ‚Äúquick fix‚Äù usually take?",
          a: [
            "5 minutes",
            "30 minutes",
            "2 hours",
            "Depends on who is doing it",
            "The rest of the week",
          ],
          c: 3,
        },
        {
          q: "What's the most common phrase in stand-up?",
          a: [
            "No blockers",
            "Still investigating",
            "Waiting on someone other team",
            "I'll create a ticket",
            "I think I was the last one",
          ],
          c: 4,
        },
        {
          q: "Who is most likely to refactor half the codebase and wait more than a year for code review?",
          a: ["Ramona", "Cosmin", "Raluca", "Ioan", "Emilia"],
          c: 3,
        },
        {
          q: "What happens when more devs review the same PR at the same time?",
          a: [
            "Instant approval",
            "One tiny comment",
            "Healthy discussion",
            "Starts a philosophical debate about naming on the devs chat",
          ],
          c: 3,
        },
        {
          q: "The phrase ‚ÄúLet's make it scalable‚Äù usually means:",
          a: [
            "Better performance",
            "Cleaner architecture",
            "We don't know yet",
            "More meetings",
          ],
          c: 3,
        },
        {
          q: "QA says: ‚ÄúI found something small.‚Äù What does it mean?",
          a: [
            "Oh boy, there are actually at least 3 things",
            "One typo",
            "Minor UI issue",
            "App crash",
            "The entire feature is unusable",
          ],
          c: 0,
        },
        {
          q: "How do QAs find bugs no one else sees?",
          a: [
            "Automated tests",
            "Edge cases",
            "Dark magic",
            "Clicking the one button nobody touches",
          ],
          c: 3,
        },
        {
          q: "PO says ‚ÄúJakie asked us to do just one small change.‚Äù How big is it?",
          a: ["5 minutes", "Half a day", "One week", "One week + refactor"],
          c: 3,
        },
        {
          q: "Production is down. Who is blamed first?",
          a: [
            "The person who made the ticket",
            "Other team",
            "QA",
            "Infrastructure",
          ],
          c: 2,
        },
        {
          q: "What happens after ‚ÄúLet's deploy quickly‚Äù?",
          a: [
            "Smooth release. Because we're the best",
            "Nothing",
            "Hotfix",
            "Live issues channel lights up",
          ],
          c: 3,
        },
        {
          q: "The most dangerous sentence in the team is:",
          a: [
            "Trust me",
            "It's simple",
            "We don't need unit tests",
            "Let's do it live",
            "All of the above",
          ],
          c: 4,
        },
        {
          q: "Who blames the issues on Microsoft poor documentation?",
          a: ["Cosmin", "Emilia", "Ioan", "Raluca", "Ramona"],
          c: 1,
        },
        {
          q: "Who's birthday is tomorrow?",
          a: [
            "Corina",
            "Cosmin",
            "Cristina",
            "Ioan",
            "Mada",
            "Monica",
            "Raluca",
            "Ramona",
          ],
          c: 3,
        },
        {
          q: "If this game had bugs, who would find them first?",
          a: ["Devs", "QA", "PO", "Other people", "THIS GAME HAS NO BUGS"],
          c: 4,
        },
      ];

      /* =========================
   3) UI state
========================= */
      let state = { player: "", active: false, idx: 0, streak: 0, points: 0 };
      let currentRoundId = null;

      function setPlayer(name) {
        state.player = (name || "").trim();
        $("#who").textContent = state.player || "‚Äî";
      }
      function setRoundScore(n) {
        state.points = n | 0;
        $("#roundScore").textContent = state.points;
      }

      /* =========================
   4) Shared leaderboard (live)
========================= */
      function renderLeaderboard() {
        scoresRef.orderBy("score", "desc").onSnapshot((snap) => {
          const wrap = $("#leaderboard");
          wrap.innerHTML = "";
          if (snap.empty) {
            wrap.innerHTML = `<div class="hint">No scores yet ‚Äî be the first üéÖ</div>`;
            return;
          }
          snap.docs.forEach((doc, i) => {
            const medal =
              i === 0 ? "ü•á" : i === 1 ? "ü•à" : i === 2 ? "ü•â" : "üéÑ";
            const name = doc.id;
            const score = doc.data().score ?? 0;
            const row = document.createElement("div");
            row.className = "lbrow";
            row.innerHTML = `
        <div style="display:flex;gap:10px;align-items:center;min-width:0">
          <div class="badge">${medal}</div>
          <strong style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${name}</strong>
        </div>
        <div class="score">${score}</div>
      `;
            wrap.appendChild(row);
          });
        });
      }

      function addScoreToSharedBoard(name, delta) {
        if (!name) return;
        scoresRef.doc(name).set(
          {
            score: firebase.firestore.FieldValue.increment(delta),
            updated: firebase.firestore.FieldValue.serverTimestamp(),
          },
          { merge: true }
        );
      }

      /* =========================
   5) Trivia rendering
========================= */
      function renderQuestion() {
        const item = TRIVIA[state.idx];
        arena.innerHTML = `
    <div class="hint"><b>Q${state.idx + 1}/${TRIVIA.length}:</b> ${item.q}</div>
    <div class="wordgrid" id="answers"></div>
    <div style="height:10px"></div>
    <div class="hint">Streak: <b>${state.streak}</b> ‚Ä¢ Points: <b>${
          state.points
        }</b></div>
    <div class="toast" id="toast"></div>
  `;

        const ans = $("#answers");
        item.a.forEach((txt, i) => {
          const b = document.createElement("button");
          b.className = "wbtn";
          b.textContent = txt;
          b.onclick = () => {
            if (!state.active) return;

            const correct = i === item.c;
            if (correct) {
              state.streak++;
              const gain = 2 + Math.min(6, state.streak);
              setRoundScore(state.points + gain);
              b.classList.add("good");
              toast(`Correct! +${gain}`);
            } else {
              state.streak = 0;
              setRoundScore(Math.max(0, state.points - 1));
              b.classList.add("bad");
              toast("Nope! -1");
            }

            [...ans.children].forEach((x) => (x.disabled = true));

            setTimeout(() => {
              state.idx++;
              if (state.idx >= TRIVIA.length) {
                // Player finished, but submission happens when HOST ends the round
                state.active = false;
                $("#status").textContent = "FINISHED (WAITING HOST)";
                arena.innerHTML = `
            <div style="font-size:34px;font-weight:1000;letter-spacing:.4px;text-shadow:0 8px 18px rgba(0,0,0,.35)">
              ‚úÖ Done ‚Äî ${state.points} pts
            </div>
            <div class="hint" style="margin-top:10px">
              Waiting for the host to end the round‚Ä¶
            </div>
            <div class="toast" id="toast"></div>
          `;
              } else {
                renderQuestion();
              }
            }, 650);
          };
          ans.appendChild(b);
        });
      }

      /* =========================
   6) Global game control
========================= */
      function setPhaseLabel(phase) {
        $("#status").textContent = (phase || "LOBBY").toUpperCase();
      }

      // Submit once per round per device
      async function submitOnceForRound(roundId) {
        if (!roundId) return;
        if (!state.player) return;

        const key = `submitted_${roundId}_${state.player}`;
        if (localStorage.getItem(key) === "1") return;

        if (state.points > 0) {
          addScoreToSharedBoard(state.player, state.points);
        }

        localStorage.setItem(key, "1");
        setRoundScore(0);
      }

      gameStateRef.onSnapshot((doc) => {
        const gs = doc.data() || { phase: "lobby", roundId: null };
        currentRoundId = gs.roundId || currentRoundId;

        setPhaseLabel(gs.phase);

        if (gs.phase === "playing") {
          // Start for everyone
          state.active = true;
          state.idx = 0;
          state.streak = 0;
          setRoundScore(0);

          if (!state.player) {
            arena.innerHTML = `
        <div class="hint">
          Round started, but you haven't typed a name yet.<br/>
          Type your name above, then you can play (refresh not required).
        </div>
        <div class="toast" id="toast"></div>
      `;
            return;
          }
          renderQuestion();
        }

        if (gs.phase === "ended") {
          // Stop for everyone + submit once
          state.active = false;
          submitOnceForRound(gs.roundId);

          arena.innerHTML = `
      <div class="hint">
        <b>Round ended.</b> Leaderboard updated üèÜ
      </div>
      <div class="hint" style="margin-top:8px">
        Start another round when ready.
      </div>
      <div class="toast" id="toast"></div>
    `;
        }

        if (gs.phase === "lobby") {
          state.active = false;
          arena.innerHTML = `
      <div class="hint">
        Type your name to join. Waiting for the host to press <b>Start</b>.
      </div>
      <div class="toast" id="toast"></div>
    `;
        }
      });

      /* =========================
   7) Buttons (host controls)
========================= */
      $("#playerName").addEventListener("input", (e) =>
        setPlayer(e.target.value)
      );

      // Start: host starts a new round for everyone
      $("#startBtn").addEventListener("click", async () => {
        if (!requireHost()) return;

        const roundId = String(Date.now());
        await gameStateRef.set(
          {
            phase: "playing",
            roundId,
            startedAt: firebase.firestore.FieldValue.serverTimestamp(),
          },
          { merge: true }
        );

        toast("Round started");
      });

      // End turn: host ends round for everyone (and triggers auto-submit)
      $("#endTurnBtn").addEventListener("click", async () => {
        if (!requireHost()) return;

        const snap = await gameStateRef.get();
        const gs = snap.data() || {};
        if (gs.phase !== "playing") {
          toast("No active round");
          return;
        }

        await gameStateRef.set(
          {
            phase: "ended",
            endedAt: firebase.firestore.FieldValue.serverTimestamp(),
          },
          { merge: true }
        );

        toast("Round ended");
      });

      // Reset leaderboard (host only)
      $("#resetAll").addEventListener("click", async () => {
        if (!requireHost()) return;
        if (!confirm("Reset leaderboard for everyone?")) return;

        const snap = await scoresRef.get();
        const batch = db.batch();
        snap.forEach((doc) => batch.delete(doc.ref));
        await batch.commit();

        // Return to lobby (optional)
        await gameStateRef.set({ phase: "lobby" }, { merge: true });

        toast("Leaderboard reset");
      });

      // Demo (anyone can click; remove if you want)
      $("#seedDemo").addEventListener("click", async () => {
        const demo = { Alex: 12, Sam: 21, Taylor: 15, Jordan: 9 };
        const batch = db.batch();
        Object.entries(demo).forEach(([name, score]) => {
          batch.set(
            scoresRef.doc(name),
            {
              score,
              updated: firebase.firestore.FieldValue.serverTimestamp(),
            },
            { merge: true }
          );
        });
        await batch.commit();
        toast("Demo added");
      });

      /* Boot */
      renderLeaderboard();
    </script>
  </body>
</html>
